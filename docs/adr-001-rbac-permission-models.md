# ADR-001: 权限管理模型设计决策

- **状态**: `已采纳`
- **日期**: `2025-07-03`
- **决策者**: `shrek`

---

## 上下文 (Context)

项目在初始阶段需要建立一套用户认证和权限管理体系，以支撑后续所有需要用户身份和权限控制的功能。我们需要在"实现的简洁性"和"未来的扩展性"之间做出权衡。

## 决策驱动因素 (Decision Drivers)

1.  **快速实现**: 需要尽快完成当前的核心认证和用户管理功能。
2.  **满足当前需求**: 新的权限模型必须能支持"普通用户"和"管理员"两种角色的区分。
3.  **未来的可扩展性**: 设计不应成为未来实现更复杂权限系统（如：动态角色、精细化权限）的阻碍。
4.  **低心智负担**: 在项目初期，应保持技术方案的简洁，降低团队成员的理解和维护成本。

## 备选方案 (Considered Options)

### 方案 A: 基于角色的访问控制 (RBAC - Role-Based Access Control)

- **描述**: 在 `User` 数据表中增加一个 `role` 字段 (如: `String` 类型)，用来直接存储用户的角色标识 (e.g., `'user'`, `'admin'`)。权限检查直接在代码中通过判断该字段的值来完成。
- **优点**:
    - **极其简单**: 容易理解和实现，开发速度快。
    - **零额外表**: 无需增加新的数据库表，仅在 `User` 表上增加一个字段。
    - **满足当前需求**: 能完美支持"用户/管理员"的二元角色划分。
- **缺点**:
    - **僵化**: 新增角色或修改角色权限需要修改代码。
    - **不易扩展**: 无法支持一个用户拥有多个角色，或为特定用户授予特殊权限。

### 方案 B: 基于权限的精细化访问控制 (Permission-Based AC)

- **描述**: 将"角色 (Roles)"和"权限 (Permissions)"本身作为数据存入数据库。通常需要新增 `roles`, `permissions`, `role_permissions` (多对多), 以及 `user_roles` (多对多) 等数据表来构建一个完整的权限体系。权限检查通过查询数据库中用户的权限集合来完成。
- **优点**:
    - **极其灵活**: 可以在不修改代码的情况下，通过管理数据来调整权限。
    - **高度可扩展**: 能支持多角色、单用户授权等几乎所有复杂的业务场景。
- **缺点**:
    - **初始实现复杂**: 需要设计和创建 3-4 张额外的数据库表。
    - **性能开销**: 权限检查需要进行多次数据库查询（可由缓存缓解）。
    - **心智负担高**: 增加了项目的整体复杂度和理解成本。

## 决策结果 (Decision Outcome)

**采纳方案 A**。

**理由**:

1.  **遵循 YAGNI (You Ain't Gonna Need It) 原则**: 方案 A 以最小的实现成本，完美地满足了项目当前阶段的所有需求。方案 B 虽然强大，但其复杂性对于当前阶段属于"过度设计"。
2.  **保障开发速度**: 选择最简单的有效方案，能让我们更快地完成核心功能的交付。
3.  **保留平滑演进路径**: 从方案 A 演进到方案 B 的路径非常清晰。当未来业务复杂度真的需要方案 B 时，我们可以通过一次性的数据迁移脚本，将 `role` 字段的数据无缝迁移到新的 `roles` 和 `user_roles` 表中，然后逐步替换权限检查的逻辑。当前的设计不会成为未来的技术债务。

我们选择现在为速度和简洁性优化，同时为未来的复杂性保留可能性，而不是提前为它买单。 