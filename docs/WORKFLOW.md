# 新功能开发工作流指南

本指南定义了从构思到部署一个新功能的标准化、端到端流程。它旨在通过"后端先行"和维护"活文档"的策略，最大化地提升开发效率和团队协作质量。

## 核心理念

1.  **后端先行 (Backend First)**: 先构建和验证后端 API，为前端提供稳定可靠的数据"弹药"，减少前后端并行开发中的等待和返工。
2.  **活文档 (Living Document)**: 每个功能都对应一份**功能设计文档 (FDD)**。这份文档会在开发的不同阶段被不断丰富和更新，而不是一次性的静态文件。它是功能的"单一事实来源"。

## 开发流程

### 阶段 0: 规划与设计 (规划启动)

**目标**: 快速对齐认知，确定边界，评估工作量。设计应保持在**高层级**。

1.  **创建 FDD 文档**: 从 `docs/FDD_TEMPLATE.md` 复制一份新文档，例如 `docs/fdd-xxx-feature-name.md`。
2.  **与 AI/团队沟通**: 讨论并明确新功能的目标、范围和技术可行性。
3.  **填写 FDD (v0.1 草稿)**:
    -   **背景与目标**: 完整填写。
    -   **AI 探索与技术选型**: 记录核心决策和理由。
    -   **功能设计 (高层级)**:
        -   **数据库**: 识别出需要的新表和它们之间的关系。
        -   **API**: 定义出需要的路由端点 (URL, HTTP 方法) 及其核心职责。
    -   **测试要点**: 列出核心测试用例。

### 阶段 1: 后端开发 (实现 API)

**目标**: 实现并交付稳定可靠的 API 端点。

1.  **启动开发环境**: 运行 `pnpm dev`。
2.  **细化设计与开发**:
    -   **数据模型**: 在 `backend/src/.../models.py` 中定义精确的 SQLAlchemy 模型（包括数据类型、约束、索引）。
    -   **数据库迁移**: 使用 `pnpm be:shell` 和 `alembic` 生成迁移脚本，然后用 `pnpm be:migrate` 应用迁移。
    -   **业务逻辑**: 在 `service.py` 中实现核心业务逻辑。
    -   **API 路由**: 在 `router.py` 中创建 API 端点，并使用 `schemas.py` 定义完整的请求/响应模型和错误处理。
3.  **API 测试**: 使用 `http://localhost:8000/docs` 的 Swagger UI 彻底测试所有新创建的端点。
4.  **更新 FDD (v0.2 实现版)**:
    -   回到 FDD 文档，将**后端设计**部分的内容，从"高层级"描述更新为"细节级"的实现快照（可附上关键代码片段或详细的 Schema 定义）。

### 阶段 2: 前端开发 (构建 UI)

**目标**: 基于已交付的 API，构建用户界面和交互。

1.  **API 调用封装**: 在对应模块的 `composables` 中封装对新 API 的调用。
2.  **组件与页面开发**: 创建新的 Vue 组件和页面，实现用户界面。
3.  **状态管理 (如需)**: 如果功能复杂，使用 Pinia 管理状态。
4.  **更新 FDD (v0.3 完整版)**:
    -   回到 FDD 文档，更新**前端设计**部分，补充组件的 Props/Events 定义或状态管理的设计。

### 阶段 3: 联调与收尾 (集成上线)

**目标**: 完成端到端测试，确保功能质量，合并代码。

1.  **端到端测试**: 在本地环境中完整地测试整个用户流程。
2.  **代码审查 (Code Review)**: 创建一个拉取请求 (Pull Request)，邀请团队成员审查。审查的核心依据是代码是否遵循了 `CONTRIBUTING.md` 和 FDD 中的规范。
3.  **合并与部署**: 代码审查通过后，合并到主分支，并可根据部署流程进行生产环境的发布。
4.  **归档 FDD (v1.0 最终版)**: 将 FDD 标记为 `v1.0`，它正式成为该功能的技术档案。 