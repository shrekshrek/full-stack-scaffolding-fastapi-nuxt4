
# RBAC 权限工作流指南

这份文档阐明在使用动态RBAC系统时，哪些操作需要修改代码，哪些操作可以完全通过管理后台动态完成。

---

**核心问题：新增或删除权限，是否需要修改代码并重新部署？**

**简要回答：这取决于操作的性质。**
-   为应用增加**全新的功能**，需要修改代码。
-   调整**谁可以使用**某个现有功能，则完全不需要修改代码。

为了更好地理解这一点，我们将权限管理分为两个层面：

1.  **权限的“定义与分配”**：在系统中创建权限记录，并将其与角色关联。*这部分是动态的，通过UI完成。*
2.  **权限的“消费与使用”**：在代码中检查用户是否拥有某个权限，以决定是否渲染UI或执行操作。*这部分是硬编码的。*

---

### 场景一：新增一个全新的功能（需要修改代码）

假设我们需要增加一个全新的“导出PDF”功能。

**步骤 1: 在管理后台“定义”新权限 (无需代码)**

1.  访问 **权限管理** 页面，创建一个新的权限标识，例如 `report:export-pdf`。
2.  访问 **角色管理** 页面，编辑“经理”角色，将 `report:export-pdf` 权限勾选并保存。

> ✅ **结果**：至此，系统已经“知道”了 `report:export-pdf` 权限的存在，并且“经理”角色拥有了它。这个过程是**实时生效**的。

**步骤 2: 在前端代码中“使用”新权限 (需要代码)**

现在，我们需要在界面上添加一个实际的“导出PDF”按钮，并用新权限来保护它。

1.  打开前端代码中相应的 `.vue` 文件。
2.  添加新的UI元素和权限检查逻辑。

    ```vue
    <template>
      <!-- ...其他内容... -->

      <!-- 使用 <PermissionGuard> 保护新添加的按钮 -->
      <PermissionGuard permissions="['report:export-pdf']">
        <UButton @click="exportPdf">导出为 PDF</UButton>
      </PermissionGuard>
    </template>
    ```
3.  提交代码修改，然后重新编译和部署。

> ✅ **结论**：为应用引入一个**全新的、需要被权限控制的功能点**时，你必须修改代码来“消费”这个新权限。

---

### 场景二：调整现有功能的权限分配 (无需修改代码)

假设“导出PDF”功能已上线。现在需要让“分析师”角色也拥有此权限。

**操作步骤：**

1.  登录系统，进入 **角色管理** 页面。
2.  找到并编辑“分析师”角色。
3.  在权限列表中，勾选上 `report:export-pdf` 权限。
4.  保存。

**完成！**

-   **无需** 任何代码改动。
-   **无需** 重新编译或部署。
-   所有“分析师”角色的用户**立即获得了新权限**，刷新页面即可看到“导出PDF”按钮。

> ✅ **结论**：这正是动态RBAC系统的核心优势。调整**谁（哪个角色）拥有什么权限**是完全动态的，由数据库中的配置决定，可以由非技术人员安全、实时地完成。

---

### 工作流总结

| 操作类型 | 是否需要修改代码并重新部署？ | 核心原因 |
| :--- | :--- | :--- |
| **新增/删除一个全新的功能** | ✅ **是** | 你需要编写或移除业务逻辑和UI，并用一个新的权限字符串来绑定它。 |
| **调整已有功能的权限分配** | ❌ **否** | 权限的**分配策略**是动态的，通过数据库配置实时生效，无需改动代码。 |

**一句话原则：权限的“消费逻辑”是硬编码在程序中的，但权限的“分配策略”是完全动态配置的。** 